<?xml version="1.0" encoding="UTF-8"?>
<!--
    Copyright (c) 2016, 2018 IBM Corporation and others.

    This program and the accompanying materials
    are made available under the terms of the Eclipse Public License 2.0
    which accompanies this distribution, and is available at
    https://www.eclipse.org/legal/epl-2.0/

    SPDX-License-Identifier: EPL-2.0
   
    Contributors:
        David Williams - initial API and implementation
 -->

<project
  name="Publish Build"
  default="generateIndex">

	<target name="generateIndex"
    depends="initResultsVariables">
		<property
      name="class"
      value="org.eclipse.releng.generators.TestResultsGenerator" />
		<taskdef name="indexResults" classname="${class}" />

		<echo message=" = = properties in publish.xml == " />
		<echo message="     isBuildTested: ${isBuildTested}" />
		<echo message="     buildType:  ${buildType}" />
		<echo message="     dropTokenList: ${dropTokenList}" />
		<echo message="     indexFileName: ${indexFileName}" />
		<echo message="     xmlDirectoryName: ${xmlDirectoryName}" />
		<echo message="     dropDirectoryName: ${buildDirectory}" />
		<echo message="     dropTemplateFileName: ${dropTemplateFileName}" />
		<echo message="     testResultsHtmlFileName: ${testResultsHtmlFileName}" />
		<echo message="     hrefTestResultsTargetPath: ${hrefTestResultsTargetPath}" />
		<echo message="     hrefCompileLogsTargetPath: ${hrefCompileLogsTargetPath}" />
		<echo message="     compileLogsDirectoryName: ${compileLogsDirectoryName}" />
		<echo message="     testManifestFileName: ${manifestFile}" />
		<echo message="     testsConfigExpected: ${testsConfigExpected}" />
		<echo message="     expectedConfigFilename: ${expectedConfigFilename}" />
		<echo message="     foundConfigFilename: ${foundConfigFilename}" />
		<echo message="     doMissingListValue:  ${doMissingListValue}" />
		<indexResults
      isBuildTested="${isBuildTested}"
      buildType="${buildType}"
      dropTokenList="${dropTokenList}"
      dropHtmlFileName="${indexFileName}"
      xmlDirectoryName="${xmlDirectoryName}"
      dropDirectoryName="${buildDirectory}"
      dropTemplateFileName="${dropTemplateFileName}"
      testResultsHtmlFileName="${testResultsHtmlFileName}"
      hrefTestResultsTargetPath="${hrefTestResultsTargetPath}"
      hrefCompileLogsTargetPath="${hrefCompileLogsTargetPath}"
      compileLogsDirectoryName="${compileLogsDirectoryName}"
      testManifestFileName="${manifestFile}"
      testsConfigExpected="${testsConfigExpected}"
      expectedConfigFilename="${expectedConfigFilename}"
      foundConfigFilename="${foundConfigFilename}"
      doMissingList="${doMissingListValue}" />
	</target>

	<target name="initResultsVariables">
		<fail unless="buildDirectory" />
		<fail unless="buildType" />
		<fail unless="testsConfigExpected" />
		<fail unless="manifestFile" />

		<property name="isBuildTested" value="true" />

		<property name="dropTokenList" value="%repository%,%sdk%,%tests%,%runtime%,%jdtc%,%swt%" />

		<property name="indexFileName" value="" />

		<!-- xml results directory -->
		<property name="xmlDirectoryName" value="${buildDirectory}/testresults/xml" />
		
		<property name="dropTemplateFileName" value="" />

		<property name="testResultsHtmlFileName" value="testResultsTables.html" />

		<property name="hrefTestResultsTargetPath" value="testresults" />

		<property name="hrefCompileLogsTargetPath" value="compilelogs/plugins/" />
		<property name="compileLogsDirectoryName" value="" />

		<!-- normal unit tests configs -->
		<property name="expectedConfigFilename" value="testConfigs.php" />

		<property name="foundConfigFilename" value="testConfigsFound.php" />

		<!-- we should be able to do this now, and refine list in manifest. -->
		<property name="doMissingListValue" value="true" />

	</target>

</project>
