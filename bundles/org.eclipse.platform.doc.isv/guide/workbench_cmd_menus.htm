<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><HTML>
<HEAD>

<meta name="copyright" content="Copyright (c) IBM Corporation and others 2006,2007. This page is made available under license. For full details see the LEGAL in the documentation book that contains this page." >

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="../book.css" CHARSET="ISO-8859-1" TYPE="text/css">
<script language="JavaScript" src="PLUGINS_ROOT/org.eclipse.help/livehelp.js"></script>
<TITLE>org.eclipse.ui.menus</TITLE>

<link rel="stylesheet" type="text/css" HREF="../book.css">
</HEAD>
<BODY BGCOLOR="#ffffff">
<h3>org.eclipse.ui.menus</h3>

<p>
Commands can be implemented using 
<a href="../reference/extension-points/org_eclipse_ui_handlers.html">org.eclipse.ui.handlers</a>
and bound to keys using
<a href="../reference/extension-points/org_eclipse_ui_bindings.html">org.eclipse.ui.bindings</a>.
With the 
<a href="../reference/extension-points/org_eclipse_ui_menus.html">org.eclipse.ui.menus</a>
extension point they can be placed in the main menu, view dropdown menus, context
menus.  They can also be added to the main toolbar, view toolbars, and various
trim locations.
</p>

<h4>Contribution location</h4>
<p>
The older action contribution points use the concept of 
<a href="workbench_menupaths.htm" class="XRef">menu and toolbar paths</a>
to place menu items and tool items.  The <b>org.eclipse.ui.menus</b>
extension point requires the id of a menu, toolbar, or trim area and an insertion
point.  This is the <b>locationURI</b> of a &lt;menuContribution/&gt; element.
Some examples of <b>locationURIs</b>:
<ul>
<li>menu:org.eclipse.ui.main.menu?after=window - insert this contribution in the
main menu after the <b>Window</b> menu.</li>
<li>menu:file?after=additions - insert this contribution in the <b>File</b> menu
after the additions group.  Equivalent to the old menubarPath="file/additions".</li>
<li>menu:org.eclipse.ui.views.ContentOutline?after=additions - insert this
contribution in the Content Outline view dropdown menu after the additions group.</li>
<li>toolbar:org.eclipse.ui.views.ContentOutline?after=additions - insert this
contribution in the Content Outline view toolbar, after the additions group.</li>
<li>popup:org.eclipse.ui.examples.propertysheet.outline?after=additions - insert
this contribution in the Property Sheet outline page context menu after
the additions group.</li>
</ul>
</p>
<p>
A word about popup: locationURIs.  In <code>popup:id</code>, the id refers to
the id that comes from registering the context menu when the registerContextMenu(*)
method is called.  If an no id is specified in the call, it defaults to the id of
the view or editor registering the context menu.
</p>
<p>
The workbench defines all of its group slot names in the classes 
<b><a href="../reference/api/org/eclipse/ui/IWorkbenchActionConstants.html">IWorkbenchActionConstants</a></b>
and <b><a href="../reference/api/org/eclipse/ui/ide/IIDEActionConstants.html">IIDEActionConstants</a></b>.
These ids, like the <b>file</b> example above, are available to menu contributions.
</p>
<p>
After the <b>locationURI</b> specifies the insertion point, the &lt;menuContribution/&gt;
elements are turned into IContributionItems and inserted in order.  Another
difference between menu contributions and action contributions is that the menu
contributions can be defined in the XML in the same kind of containing relationship
that would would see in a menu or toolbar.
</p>
<p>
Let's start with a simple example from our Info example, adding some commands
to the InfoView.
<pre>
   &lt;extension
         point=&quot;org.eclipse.ui.menus&quot;&gt;
      &lt;menuContribution
            locationURI=&quot;menu:org.eclipse.ui.examples.contributions.view?after=additions&quot;&gt;
         &lt;command
               commandId=&quot;org.eclipse.ui.examples.contributions.view.count&quot;
               mnemonic=&quot;%contributions.view.count.mnemonic&quot;&gt;
         &lt;/command&gt;
         &lt;command
               commandId=&quot;org.eclipse.ui.examples.contributions.view.edit&quot;
               mnemonic=&quot;%contributions.view.edit.mnemonic&quot;&gt;
         &lt;/command&gt;
         &lt;command
               commandId=&quot;org.eclipse.ui.file.refresh&quot;
               mnemonic=&quot;%contributions.view.refresh.mnemonic&quot;&gt;
         &lt;/command&gt;
      &lt;/menuContribution&gt;
      ...
</pre>
</p>
<p>
Our <b>locationURI</b> marks this contribution for the org.eclipse.ui.examples.contributions.view
view. Here we are adding 3 commands to the InfoView dropdown menu: Count Entries,
Edit, and Refresh.  Although you can specify a <b>label</b> in the menu
contribution &lt;command/&gt; element, if you don't we will use the <b>name</b>
attribute from the 
<a href="../reference/extension-points/org_eclipse_ui_commands.html">org.eclipse.ui.commands</a>
command definition.  Now clicking on the menu element will execute that command.
</p>
<p>
We've also placed a command in the InfoView toolbar:
<pre>
      &lt;menuContribution
            locationURI=&quot;toolbar:org.eclipse.ui.examples.contributions.view?after=additions&quot;&gt;
         &lt;command
               commandId=&quot;org.eclipse.ui.examples.contributions.view.swap&quot;
               label=&quot;%contributions.view.swap.name&quot;
               tooltip=&quot;%contributions.view.swap.tooltip&quot;&gt;
         &lt;/command&gt;
      &lt;/menuContribution&gt;
</pre>
</p>

<h4>Contribution visibility</h4>

<p>
A command's enabled state is controlled by a combination of the command
is handled and if so, the handler's enabled state.  Menu contributions
can use core expressions to control the command's visibility in menus and
toolbars.
</p>
<p>
As an example, menu contributions can still be tied to an existing action
set while being contributed to the main menu or main toolbar, as action sets
are converted into contexts.  In this example
we  place our command in the main menu and main toolbar.
<pre>
   &lt;extension
         point=&quot;org.eclipse.ui.actionSets&quot;&gt;
      &lt;actionSet
            id=&quot;org.eclipse.ui.examples.contributions.globalActionSet&quot;
            label=&quot;%contributions.globalActionSet.label&quot;
            visible=&quot;false&quot;&gt;
      &lt;/actionSet&gt;
   &lt;/extension&gt;
   &lt;extension
         point=&quot;org.eclipse.core.expressions.definitions&quot;&gt;
      &lt;definition
            id=&quot;org.eclipse.ui.examples.contributions.inGlobalActionSet&quot;&gt;
         &lt;with
               variable=&quot;activeContexts&quot;&gt;
            &lt;iterate
                  operator=&quot;or&quot;&gt;
               &lt;equals
                     value=&quot;org.eclipse.ui.examples.contributions.globalActionSet&quot;&gt;
               &lt;/equals&gt;
            &lt;/iterate&gt;
         &lt;/with&gt;
      &lt;/definition&gt;
      ...
</pre>
</p>
<p>
The above XML defines the action set to use, and a definition for a core expression
that checks contexts to see if the action set is active.  See the <a href="workbench_cmd_handlers.htm"
class="XRef">org.eclipse.ui.handlers</a> section for other examples of core
expressions. 
</p>
<p>
Now we can add our command to the main menu:
<pre>
      &lt;menuContribution
            locationURI=&quot;menu:org.eclipse.ui.main.menu?after=additions&quot;&gt;
         &lt;menu
               label=&quot;%contributions.menus.globalMenu.label&quot;
               mnemonic=&quot;%contributions.menus.globalMenu.label&quot;
               id=&quot;org.eclipse.ui.examples.contributions.menus.globalMenu&quot;&gt;
            &lt;command
                  commandId=&quot;org.eclipse.ui.examples.contributions.commands.globalCommand&quot;
                  mnemonic=&quot;%contributions.menus.globalCommand.mnemonic&quot;
                  id=&quot;org.eclipse.ui.examples.contributions.menus.globalCommand&quot;&gt;
               &lt;visibleWhen&gt;
                  &lt;reference
                        definitionId=&quot;org.eclipse.ui.examples.contributions.inGlobalActionSet&quot;&gt;
                  &lt;/reference&gt;
               &lt;/visibleWhen&gt;
            &lt;/command&gt;
            &lt;separator
                  name=&quot;additions&quot;
                  visible=&quot;false&quot;&gt;
            &lt;/separator&gt;
         &lt;/menu&gt;
      &lt;/menuContribution&gt;
      &lt;menuContribution
            locationURI=&quot;toolbar:org.eclipse.ui.main.toolbar?after=additions&quot;&gt;
         &lt;toolbar
               id=&quot;org.eclipse.ui.examples.contributions.toolbars.sampleToolbar&quot;&gt;
            &lt;command
                  commandId=&quot;org.eclipse.ui.examples.contributions.commands.globalCommand&quot;
                  icon=&quot;icons/sample.gif&quot;
                  tooltip=&quot;%contributions.toolbars.globalCommand.tooltip&quot;
                  id=&quot;org.eclipse.ui.examples.contributions.toolbars.globalCommand&quot;&gt;
               &lt;visibleWhen&gt;
                  &lt;reference
                        definitionId=&quot;org.eclipse.ui.examples.contributions.inGlobalActionSet&quot;&gt;
                  &lt;/reference&gt;
               &lt;/visibleWhen&gt;
            &lt;/command&gt;
            &lt;separator
                  name=&quot;additions&quot;
                  visible=&quot;false&quot;&gt;
            &lt;/separator&gt;
         &lt;/toolbar&gt;
      &lt;/menuContribution&gt;
      ...
</pre>
</p>
<p>
In the above XML, we are adding the menu &quot;Global Menu&quot; to the main menu,
and then placing the &quot;Global Command&quot; in it.  The &lt;visibleWhen/&gt;
element will evaluate the body of the previously defined inGlobalActionSet
core expression.  The &lt;separator/&gt; element adds and additions group
that can be used by other contributions.  We are also creating a toolbar
in the main coolbar (org.eclipse.ui.main.toolbar) and placing a our command
in it with the sample.gif icon.
</p>
<p>
Other contributions can now contribute to the &quot;Global Menu&quot;
menu by specifying its id as a contribution <b>locationURI</b>: 
menu:org.eclipse.ui.examples.contributions.menus.globalMenu?after=additions.
</p>
<p>
Currently, commands contributed to action sets don't show up in the 
<a class="command-link" href='javascript:executeCommand("org.eclipse.ui.window.customizePerspective")'>
<img src="PLUGINS_ROOT/org.eclipse.help/command_link.png">
<b>Window &gt; Customize Perspective...</b></a> dialog.
</p>

<p>
You can add menu contributions that work similar to <b>org.eclipse.ui.editorActions</b>.
First you define your editor command and handler, like Reset.  Then you can
add them to the main menu:
<pre>
      ... org.eclipse.core.expressions.definitions
      &lt;definition
            id=&quot;org.eclipse.ui.examples.contributions.view.activeEditor&quot;&gt;
         &lt;with
               variable=&quot;activeEditorId&quot;&gt;
            &lt;equals
                  value=&quot;org.eclipse.ui.examples.contributions.editor&quot;&gt;
            &lt;/equals&gt;
         &lt;/with&gt;
      &lt;/definition&gt;
      ... org.eclipse.ui.menus
      &lt;menuContribution
            locationURI=&quot;menu:org.eclipse.ui.main.menu?after=additions&quot;&gt;
         &lt;menu
               id=&quot;org.eclipse.ui.examples.contributions.editor.menu&quot;
               label=&quot;%contributions.editor.menu.label&quot;
               mnemonic=&quot;%contributions.editor.menu.mnemonic&quot;&gt;
            &lt;command
                  commandId=&quot;org.eclipse.ui.examples.contributions.editor.reset&quot;
                  mnemonic=&quot;%contributions.editor.reset.mnemonic&quot;&gt;
               &lt;visibleWhen&gt;
                  &lt;reference
                        definitionId=&quot;org.eclipse.ui.examples.contributions.view.activeEditor&quot;&gt;
                  &lt;/reference&gt;
               &lt;/visibleWhen&gt;
            &lt;/command&gt;
         &lt;/menu&gt;
      &lt;/menuContribution&gt;
</pre>
</p>
<p>
This is similar to adding to the main menu with our global action example.
Here our core expression
will make this element visible as long as the active editor id variable
matches our editor.  You can check out
<a href="../reference/api/org/eclipse/ui/ISources.html">org.eclipse.ui.ISources</a>
for a list of supported variables names.
</p>
<p>
<b>Note:</b> updating the main menu and especially the main toolbar are expensive
operations.  You generally want to confine them to actionSet equivalent contexts
and active editor type.  Although you can update the main toolbar on each
selection change using the default variable or a &lt;with variable=&quot;selection&quot;/&gt;
expression, it's not a good idea.  The common practice is to leave your command
visibility at the action set or active editor level, and have your handler
enabled state track the current selection.
</p>

<h4>Contributing to popup menus</h4>

<p>
As in <a href="workbench_basicext_popupMenus.htm" class="XRef">org.eclipse.ui.popupMenus</a>,
commands can be contributed to a specific context menu by the context menu's id, or to any
context menu where it can satisfy its &lt;visibleWhen&gt; clause.  For example, we can add
our Refresh command to the Info View popup as a convenience.  Because we didn't call
<code>registerContextMenu(*)</code> with a specific id it defaults to the view id.
<pre>
      &lt;menuContribution
            locationURI=&quot;popup:org.eclipse.ui.examples.contributions.view?after=additions&quot;&gt;
         &lt;command
               commandId=&quot;org.eclipse.ui.file.refresh&quot;
               mnemonic=&quot;%contributions.view.refresh.mnemonic&quot;&gt;
         &lt;/command&gt;
      &lt;/menuContribution&gt;
</pre>
</p>
<p>
To contribute a command to a popup if its selection matches a particular object type you
can use the default variable, or for behaviour closest to <b>org.eclipse.ui.popupMenus</b>
target a specific popup selection variable.  Here's an example using the context menu
selection provider.  This just effects the popup menu visibility, not the command
enabled state.
<pre>
      &lt;menuContribution
            locationURI=&quot;popup:org.eclipse.ui.popup.any?after=additions&quot;&gt;
         &lt;command
               commandId=&quot;org.eclipse.ui.examples.contributions.view.edit&quot;
               mnemonic=&quot;%contributions.view.edit.mnemonic&quot;&gt;
            &lt;visibleWhen&gt;
               &lt;with
                     variable=&quot;activeMenuSelection&quot;&gt;
                  &lt;iterate&gt;
                     &lt;adapt
                           type=&quot;org.eclipse.ui.examples.contributions.model.Person&quot;&gt;
                     &lt;/adapt&gt;
                  &lt;/iterate&gt;
               &lt;/with&gt;
            &lt;/visibleWhen&gt;
         &lt;/command&gt;
      &lt;/menuContribution&gt;
</pre>
</p>
<p>
Using &lt;iterate&gt;&lt;adapt type=&quot;Person&quot;/&gt;&lt;/iterate&gt; is
the core expression equivalent of the old <b>objectClass</b> attribute.
</p>


<h4>Adding toolbars to trim areas</h4>
<p>
A 'trim' widget is a control that gets sited into a location (called a 'Trim Area') on the outer boundary of the Workbench Window. The
most common example is the generic 'status line' which almost all GUI's place along the bottom of the window.
The extension point <b><a href="../reference/extension-points/org_eclipse_ui_menus.html">org.eclipse.ui.menus</a></b>
allows plug-ins to add views to the workbench. Plug-ins that contribute trim must register the trim in their
<b> plugin.xml </b> file and provide&nbsp; configuration information about the trim, such as its implementation class, the trim group (trim bar) that it resides in and layout information sucha s whether the trim wishes to use available 'extra' space during 
its layout within the trim area.
</p>
<p>
The interface for contributed trim is defined in <b><a href="../reference/api/org/eclipse/ui/IWorkbenchWidget.html">IWorkbenchWidget</a></b>, but plug-ins
can (are in fact encouraged) to choose to extend the
<b><a href="../reference/api/org/eclipse/ui/AbstractWorkbenchTrimWidget.html"> AbstractWorkbenchTrimWidget</a></b> class rather than implement the interface from scratch.
</p>
<p>
For the readmetool example we've contributed a fairly naive trim widget that simply displays a string and an indication of which side the trim is currently docked on.
</p>
<p>
<img src="images/readmetrim.png" alt="" border="0">
</p>
<p>
Let's take a look at the extension point definition used to contribute this piece of trim:
</p>
<pre>
      &lt;menuContribution
            locationURI=&quot;toolbar:org.eclipse.ui.trim.status&quot;&gt;
         &lt;toolbar
               id=&quot;org.eclipse.ui.examples.contributions.verticalTrim&quot;&gt;
            &lt;command
                  commandId=&quot;org.eclipse.ui.examples.contributions.item2&quot;
                  icon=&quot;icons/editor.gif&quot;
                  id=&quot;contributions.trimItem&quot;
                  label=&quot;%Trim.item&quot;
                  tooltip=&quot;%TrimItem.toolTip&quot;&gt;
            &lt;/command&gt;
            &lt;control
                  class=&quot;org.eclipse.ui.examples.contributions.ExampleControlContribution&quot;
                  id=&quot;contributions.controlContrib1&quot;&gt;
            &lt;/control&gt;
            &lt;command
                  commandId=&quot;org.eclipse.ui.examples.contributions.item2&quot;
                  icon=&quot;icons/editor.gif&quot;
                  id=&quot;contributions.trimItem2&quot;
                  label=&quot;%Trim2.item&quot;
                  tooltip=&quot;%TrimItem2.toolTip&quot;&gt;
            &lt;/command&gt;
         &lt;/toolbar&gt;
      &lt;/menuContribution&gt;
</pre>
<p>
The first section of the extension (the 'group' definition) simply defines the id of the group and defines a 'location' for the group as being at the start of the 'status' group (i.e. at the beginning of the bottom trim area). The second section (the 'widget' definition) specifies the implementation 'class' of the widget and defines the 'location' of the widget as being placed within the previously defined group.
</p>
<p>
Note that in both cases the bar's 'type' is defined as <b>trim</b> (which is the only type currently supported).
</p>
<p>
Once you have the actual <code>readmetool</code> example installed, take a look at the implementation of the <code>ReadmeTrimWidget's fill</code> method. This is different from the other <code>fill</code> methods used when adding widgets into toolbars or menus in that, because trim can be dragged from one area to another, it also passes the 'side' that the trim is being placed into, allowing the implementor to tailor the widget's display based on its location by changing orientation etc. The current implementation simply changes the displayed text to reflect the current location. Also note how the 'dispose'/'fill' life-cycle is handled; there will be repeated calls to <code>dispose</code> and <code>fill</code> generated by workbench changes (i.e. changing perspectives or dragging the trim to a new side).
</p>
<p>
One thing that is not reflected in this sample's code is the reliance of the trim layout manager on the trim's proper implementation of the widget control's <code>computeSize</code> method. The widget must be capable of calculating and returning its 'preferred' size since this is used throughout the layout management implementation to determine, for example, how much space is needed for a particular trim area. See the SWT documentation for notes on how to correctly implement '<code>computeSize</code> correctly.
</p>


</BODY>
</HTML>
