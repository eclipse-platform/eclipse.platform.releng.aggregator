<?xml version="1.0" encoding="UTF-8"?>
<project
    name="Automated Eclipse Testing"
    default="runtests"
    basedir=".">

<!-- This file is only called from "runTests2.xml" which is a "production only" 
test file so much of what is here could be combined with runTests2.xml
and in some cases they may do things redundantly.
 -->

    <target name="runtests">
        <!-- <delete dir="${testDir}" quiet="true" /> -->
        <mkdir dir="${testDir}" />
        <property
            name="testResults"
            value="${testDir}/testresults" />
        <fail unless="testFramework" />
        <fail unless="testDir" />
        <echo message="testFramework: ${testFramework}" />
        <echo message="testDir: ${testDir}" />
        <echo message="buildId: ${buildId}" />

        <!--set up testing directory-->
        <unzip
            src="${testFramework}"
            dest="${testDir}"
            overwrite="false">
            <patternset>
                <exclude name="**/equinoxp2tests.properties" />
                <exclude name="**/test.xml" />
            </patternset>
        </unzip>

        <echo message="    properties in runTests.xml" />
        <echo message="    executionDir ${executionDir}" />
        <echo message="    testExecutable ${testExecutable}" />
        <echo message="    testScript ${testScript}" />
        <echo message="    args ${args}" />
        <echo message="    ANT_OPTS: ${ANT_OPTS}" />

        <!--callback to custom script for post setup-->
        <!-- <ant antfile="${customTest}" target="customSetup" dir="${basedir}" /> -->
        <condition
            property="executionArguments"
            value="/c ${testScript} ${args}">
            <and>
                <os family="windows" />
            </and>
        </condition>
        <property
            name="executionArguments"
            value="${testScript} ${args}" />

        <!--run the tests-->
        <exec
            dir="${executionDir}"
            executable="${testExecutable}">
            <arg line="${executionArguments}" />
        </exec>
    </target>

</project>