<!DOCTYPE html>
<html>

<head>
	<!--TODO: set proper metadata/keywords? -->
	<title>Eclipse Project Downloads</title>
	<meta name="keywords" content="eclipse,project,plug-ins,plugins,java,ide,swt,refactoring,free java ide,tools,platform,open source,development environment,development,ide" />
	<link rel="preconnect stylesheet" href="../page.css" /><!-- Replaced by a refernece to a contained copy on deployment -->
	<script src="../page.js"></script><!-- Replaced by a refernece to a contained copy on deployment -->
</head>

<body>
	<div data-generate="generateDefaultBreadcrumb(this, eclipseBreadcrumbBase)">
		<a href="../..">Downloads</a>
		<span class="data-ref">${label}</span>
	</div>

	<main>

		<h2>Eclipse <span class="data-ref">${release}</span> <span class="data-ref">${buildTypeName}</span> Build: <span class="data-ref">${label}</span></h2>

		<div id="build-state-container"></div>

		<p>
			This page provides access to the various deliverables of Eclipse Platform build along with its logs and tests.
		</p>
		<ul>
			<li><a class="data-ref" href="https://eclipse.dev/eclipse/news/${releaseShort}">New and Noteworthy</a></li>
			<li><a class="data-ref" href="https://eclipse.dev/eclipse/markdown/?f=news/${releaseShort}/acknowledgements.md">Acknowledgments</a></li>
			<li><a class="data-ref" href="https://eclipse.dev/eclipse/development/readme.html?file=readme_eclipse_${releaseShort}.html">Eclipse Project ${releaseShort} Readme</a></li>
			<li><a class="data-ref" href="https://eclipse.dev/eclipse/development/plans.html?file=plans/eclipse_project_plan_${releaseShort}.xml">Eclipse Project Plan</a></li>
			<li><a class="data-ref" href="https://eclipse.dev/eclipse/development/plans/eclipse_project_plan_${releaseShort}.xml#target_environments">Target Platforms and Environments</a></li>
		</ul>

		<h3 id="reports">Reports</h3>
		<p>
			The <a href="reports.html">Reports page</a> provides detailed build and tests logs and analyses of various aspects of this build.
		</p>

		<h4 id="tests">Test Results Summary</h4>
		<p id="signOff-issue-container"></p>
		<table id="tests-overview-table">
			<thead>
				<tr>
					<th style="text-align:center; width:30%">Tested Platform</th>
					<th style="text-align:end">Failed</th>
					<th style="text-align:end">Passed</th>
					<th style="text-align:end">Total</th>
					<th style="text-align:end">Runtime</th>
				</tr>
			</thead>
		</table>

		<h4 id="git-log">Git Log</h4>
		<ul>
			<li><a href="gitLog.html">Git log</a></li>
		</ul>

		<h4 id="signatures">Checksums&nbsp;(SHA 512) and GPG&nbsp;Signatures</h4>
		<ul>
			<li><a href="https://wiki.eclipse.org/Platform-releng/How_to_check_integrity_of_downloads">How to verify a download</a></li>
		</ul>
		<p class="data-ref">
			<a href="checksum/eclipse-${label}-SUMSSHA512">SHA512 Checksums for ${label}</a>&nbsp;(<a href="checksum/eclipse-${label}-SUMSSHA512.asc">GPG</a>)
		</p>

		<h3 id="repository">Eclipse p2 Repository
			<a href="details.html#Repository"><i class="fa fa-xs fa-info-circle"></i></a>
		</h3>
		<p>
			To update your Eclipse installation to this development stream, you can use the software repository at
			<br>
			<code><a class="data-ref" href="${updatesP2RepositoryComposite}">${updatesP2RepositoryComposite}</a></code>
		</p>
		<p>
			To update your build to use this specific build, you can use the software repository at
			<br>
			<code><a class="data-ref" href="${updatesP2Repository}">${updatesP2Repository}</a></code>
		</p>
		<table class="files-table" data-path="p2Repository"></table>

		<h3 id="eclipse-sdk">Eclipse SDK
			<a href="details.html#EclipseSDK"><i class="fa fa-xs fa-info-circle"></i></a>
		</h3>
		<table class="files-table" data-path="sdkProducts"></table>

		<h3 id="testing-framework">Tests and Testing Framework
			<a href="details.html#JUnitPlugin"><i class="fa fa-xs fa-info-circle"></i></a>
		</h3>
		<table class="files-table" data-path="eclipseTests"></table>

		<h3 id="platform-runtime">Platform Runtime Binary
			<a href="details.html#PlatformRuntime"><i class="fa fa-xs fa-info-circle"></i></a>
		</h3>
		<table class="files-table" data-path="platformProducts"></table>

		<h3 id="ecj">JDT Core Batch Compiler
			<a href="details.html#JDTCORE"><i class="fa fa-xs fa-info-circle"></i></a>
		</h3>
		<table class="files-table" data-path="jdtCompiler"></table>

		<h3 id="swt">SWT Binary and Source
			<a href="details.html#SWT"><i class="fa fa-xs fa-info-circle"></i></a>
		</h3>
		<table class="files-table" data-path="swtBinaries"></table>

	</main>
	<script>
		loadPageData('buildproperties.json', data => {
			data.buildTypeName = getBuildTypeName(data)
			if (data.releaseShort) {
				data.updatesP2RepositoryComposite = `https://download.eclipse.org/eclipse/updates/${data.releaseShort}`
				const buildID = data.identifier
				const buildType = buildID.charAt(0)
				if (buildType == 'I' || buildType == 'Y') {
					data.updatesP2RepositoryComposite += `-${buildType}-builds`
				}
				if (buildType == 'S') {
					data.updatesP2RepositoryComposite += '-I-builds'
					const timestamp = buildID.substring(buildID.lastIndexOf('-') + 1, buildID.length)
					data.updatesP2Repository = `${data.updatesP2RepositoryComposite}/I${timestamp.substring(0, 8)}-${timestamp.substring(8, 12)}`
				} else {
					data.updatesP2Repository = `${data.updatesP2RepositoryComposite}/${buildID}`
				}
			}
			return data
		})

		injectUnstableBuildCause('build-state-container')

		contentPostProcessor = (mainElement, build) => {
			document.title = `${build.label} - ${document.title}`

			// Inject test results
			const jobNamePrefix = getJenkinsTestJobNamePrefix(build)
			const testJobsFolderURL = getJenkinsTestJobsFolderURL(build)

			const testResultsOverview = fetchAllJSON(build.expectedTests.map(c => `testresults/${jobNamePrefix}-${c}.json`))
			const testResultsTable = document.getElementById('tests-overview-table')
			const tBody = testResultsTable.createTBody()
			testResultsOverview.then(testResults => {
				for (let r = 0; r < testResults.length; r++) {
					const row = tBody.insertRow()
					const result = testResults[r]
					const testName = build.expectedTests[r]
					const [os, ws, arch, javaVersion] = parseTestConfiguration(testName)
					const label = `<a href="reports.html#tests">${getOSLabel(os)} (${getCPUArchLabel(arch)}) Java&nbsp;${javaVersion}</a>`
					if (result.duration) { // Test configuration completed
						row.innerHTML = `
							<td>${label}</td>
							<td style="text-align:end">${result.failCount}</td>
							<td style="text-align:end">${result.passCount}</td>
							<td style="text-align:end">${result.passCount + result.failCount}</td>
							<td style="text-align:end">${formatRuntime(result.duration)}</td>
						`
					} else {
						const jobName = `${jobNamePrefix}-${testName}`
						row.innerHTML = `
							<td>${label}</td>
							<td colspan="4"> Test job is running at <a href="${testJobsFolderURL}/job/${jobName}/">${jobName}</a></td>
						`
					}
				}
			})

			if (build.signOffIssue) {
				const signOffLabel = build.signOffIssue.replace('https://github.com/', '').replace('/issues/', '#')
				const signOffSection = document.getElementById('signOff-issue-container')
				signOffSection.innerHTML = `Any unit test failures below have been investigated and found to be test-related and to not affect the quality of the build.<br>
				For details, see <a href="${build.signOffIssue}">${signOffLabel}</a>.`
			}

			// Inject resource files
			const dataTables = Array.from(mainElement.getElementsByClassName('files-table'))
			for (const table of dataTables) {
				const dataPath = table.getAttribute('data-path')
				const filesData = getValue(build, dataPath)
				table.createTHead().innerHTML = `
					<tr>
						<th>Platform</th>
						<th style="width:50%">Download</th>
						<th>Size</th>
					</tr>
				`
				const tBody = table.createTBody()
				for (const file of filesData) {
					tBody.insertRow().innerHTML = `
					<td>${file.platform ? file.platform : getPlatformLabel(file.name)}</td>
					<td>
						<a href="${file.name}">${file.name}</a>
					</td>
					<td>${file.size}</td>
					`
					//TODO: Implement mirror-selection (but https://www.eclipse.org/downloads/download.php?file=eclipse/downloads/drops4/${build.identifier}/${file.name} doesn't work, not even for releases)
				}
			}
		}

		function getPlatformLabel(fileName) {
			let os = getOSLabel(fileName)
			let arch = getCPUArchLabel(fileName)
			return `${os} (${arch})`
		}

		generate()

	</script>
</body>

</html>